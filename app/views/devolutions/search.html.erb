<div class="container">
  <div class="row">
    <div class="col-md-12">
      <p id="notice"><%= notice %></p>

      <h1 class="text-center top-head">Devoluciones</h1>

      <%= link_to 'Ver devoluciones', devolutions_path , class:"btn btn-lg btn-success"%>
      <br>
      <div class="row">
        <div class="col-md-6 col-sm-6">
          <h2>Busca la venta a devolver:</h2>
        </div>
        <div class="col-md-6 col-sm-6">
          <br><br>

        <script>
        $( document ).ready(function() {
          $('.input-group.input-daterange').datepicker({
              format: "dd/mm/yyyy",
              language: "es",
              todayHighlight: true
          });
        });
        </script>

          <%= form_tag({controller: "devolutions", action: "search"}, method: "get") do %>
          <div class="input-group input-daterange" id="datepicker">
              <span class="input-group-addon">Del</span>
              <%= text_field_tag 'start', nil, :data => {:provide => "datepicker"}, class:"form-control" %>
              <!--<input type="text" data-provide='datepicker' class="form-control">-->
              <span class="input-group-addon">al</span>
              <%= text_field_tag 'finish', nil, :data => {:provide => "datepicker"}, class:"form-control" %>
              <!--<input type="text" data-provide='datepicker' class="form-control">-->
              <span class="input-group-btn">
              <%= submit_tag "Buscar", class:"btn btn-primary" %>
              </span>
          </div>
          <% end %>
        </div>
      </div>
      <div class="row">
        <div class="col-md-12">


          <% if @sales.size == 0 %>
            <h2>No hay ventas registradas entre las fechas consultadas</h2>
          <% else %>

          <br><br>
          <table class="table table-bordered">
            <thead>
              <tr>
                <th>Empleado</th>
                <th>Resumen de venta</th>
                <th>Fecha</th>
                <th>Total</th>
                <th colspan="1"></th>
              </tr>
            </thead> 
            <tbody>
              <% @sales.each do |sale| %>
                <% if sale.pending %>
                <tr class="warning">
                <% else %>
                <tr class="info">
                <% end %>
                  <td><%= sale.user.name %></td>
                  <td>
                    <% a = "" %>
                    <% sale.products.each do |product| %>
                      <% a += product.sale_title.split.first + ", " %>
                    <% end %>
                    <%= truncate(a, length:25) %>
                  </td>
                  <td><%= sale.updated_at.in_time_zone.to_formatted_s(:long) %></td>
                  <td> $ <%= sale.total_price %></td>
                  <td class="text-center"><%= link_to 'Seleccionar', new_devolution_path(:id => sale.id) , class:"btn btn-info" %></td>
                </tr>
              <% end %>
            </tbody>
          </table>
          <% end %>
        </div>
      </div>
      <br>
      <br>
    </div>
  </div>
</div>